<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Example - example-ngControllerAs-production</title>
  <script src="https://code.angularjs.org/snapshot/angular.min.js"></script>
  <style>
   * {
     margin: 0;
     padding: 0;
   }
    .main {
      width: 100%;
      height: 200px;
      position: relative;
      display: block;
    }
    .container-main {
      width: 100%;
      height: 100%;
      display: inline-block;
      position: relative;
    }
    .main .controls,
    .main .options {
      width: 100%;
      height: 50%;
    }
    .main .options,
    .main .controls {
      display: flex;
    }
    .main .options .option,
    .main .controls .control {
      flex: 1;
      opacity: .4;
    }
    .red {
      background-color: red;
    }
    .green {
      background-color: green;
    }
    .blue {
      background-color: blue;
    }
    .yellow {
      background-color: yellow;
    }
  </style>
</head>
<body ng-app="app">
  <div ng-controller="ControllerApp as controller" ng-init="controller.init()">
    <div class="main">
      <div class="container-main">
        <div class="controls">
          <div ng-repeat="control in controller.controls" class="control {{controller.color[control]}}" ng-click="controller.setControl(control)">
            <div class="container-control">
            </div>
          </div>
        </div>
        <div class="options" ng-show="controller.level>1">
          <div ng-repeat="option in controller.options" class="option {{controller.color[option]}}" ng-click="controller.setOption(option)">
            <div class="container-option">
            </div>
          </div>
        </div>
      </div>
    </div>
    <div>
      <p>Test Parameters:</p>
      <hr>
      <p>Level: {{controller.level}}</p>
      <p>Option: {{controller.option}}</p>
      <p>Seconds: {{controller.seconds}}</p>
      <p>Playing: {{controller.playing}}</p>
      <p>Processing: {{controller.processing}}</p>
    </div>
  </div>

<script>

(function(angular) {
'use strict';
angular.module('app', []).controller('ControllerApp', ControllerApp);

function ControllerApp($scope) {
  this.scope = $scope;
  this.control = 0;
  this.controls = ['ctr1'];
  //  ADD COLORS POSIBLE
  this.colors = ['red','green','blue','yellow'];
  //  ADD OPTIONS POSIBLE
  this.options = ['option1','option2','option3'];
  this.color = {};
  this.processing = false;
  this.playing = false;
}

ControllerApp.prototype.init = function() {
  if (this.options>=this.colors) {
    alert('error configuraciÃ³n del juego');
    return;
  }
  this.level = 1;
  this.seconds = 0;
  this.color[this.controls[this.control]] = this.rnd(this.colors);
  this.processing = false;
}
ControllerApp.prototype.setControl = function(control) {
  if (!this.processing) {
    this.processing = true;
    if (this.level==1) {
      this.gameStart();
    }
  }
};
ControllerApp.prototype.setOption = function(option) {
  if (!this.processing) {
    this.processing = true;
    if (this.level>1) {
      if (this.option==option) {
        this.levelUp();
      } else {
        this.gameOver();
      }
    }
  }
}
ControllerApp.prototype.levelUp = function() {
  this.level++;
  this.option = this.rnd(this.options);
  var color = this.color[this.controls[this.control]];
  this.setOptionColors(color);
  this.setOptionControl();
  this.processing = false;
}
ControllerApp.prototype.setOptionControl = function() {
  this.color[this.controls[this.control]] = this.rnd(this.colors);
}
ControllerApp.prototype.setOptionColors = function(color) {
  var exceptions = [];
  this.color[this.option] = color;
  exceptions.push(color);
  this.setOptionColor(0, exceptions);
}
ControllerApp.prototype.setOptionColor = function(i, exceptions) {
  if (i < this.options.length) {
    if (this.options[i]!=this.option) {
      this.setColor(i, this.rndExceptions(this.colors, exceptions), exceptions);
    } else {
      this.setOptionColor(i+1, exceptions);
    }
  }
}
ControllerApp.prototype.setColor = function(i, color, exceptions) {
  this.color[this.options[i]] = color;
  exceptions.push(color);
  this.setOptionColor(i+1, exceptions);
}
ControllerApp.prototype.gameStart = function() {
  this.playing = true;
  this.startDate = new Date().getTime();
  this.watcher = setInterval(this.setSeconds.bind(this), 100);
  this.levelUp();
}
ControllerApp.prototype.setSeconds = function() {
  var dif = (new Date()).getTime() - this.startDate;
  this.seconds = Math.abs(dif/1000).toFixed(1);
  this.scope.$apply();
}
ControllerApp.prototype.gameOver = function() {
  this.processing = true;
  this.playing = false;
  clearInterval(this.watcher);
  alert('restarting...');
  this.init();
}
ControllerApp.prototype.rndExceptions = function(array, exceptions) {
  var arr = array.filter(function(el) {
    return exceptions.indexOf(el) < 0;
  });
  var rnd = this.rnd(arr);
  return rnd;
};
ControllerApp.prototype.rnd = function(arr) {
  return arr[Math.floor(Math.random()*arr.length)];
};


})(window.angular);

</script>

</body>
</html>
